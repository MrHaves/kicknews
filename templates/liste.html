{% extends 'base.html' %}

{% block style %}
	{{block.super}}
	.nav-tabs li.active a{
		background: #f5f5f5;
	}
	.nav-tabs li.active:hover a{
		background: #f5f5f5;
	}

	.divider {
		width: 100%;
		border-bottom: 1px solid #ddd;
		margin-top: 25px;
		margin-bottom: 20px;
	}
{% endblock style %}



{% block menu %}
	<li {% if catActive == 'all' %}class="active"{% endif %}>
	<a href="/categories/">All</a>
	</li>
	{% for cat in categories %}
		<li {% if cat.url == catActive %}class="active"{% endif %}><a href="/categories/{{cat.url}}">{{cat|title}}</a></li>
	{% endfor %}
{% endblock menu %}

{% block content %}

	<div class="mosaic-wrapper">

	  {% for article in articles %}
		  <div class="page random-page article-{{article.id}}">
			<div class="row">
				<div class="span8">
					<h2>{{article.title}}</h2>
					<div class="infos-article">
						<p class="left"><i class="icon-calendar"></i>{{article.date.date}} Ã  {{article.date.hour}}:{{article.date.minute}}</p>
						<p class="left"><i class="icon-user"></i><a href="/profile/{{article.memberId.id}}">{{article.memberId}}</a></p>
						<p class="left"><i class="icon-bookmark"></i><a href="/categories/{{article.category.url}}">{{article.category}}</a></p>
						<div class="clear"></div>
					</div>
					<div class="text-article">
						{% if article.media %}
							{% if mediaType == "vid" %}
								<video controls>
									<source src="/media/{{article.media}}" type="{{mime}}">
								</video>
							{% else %}
								<img src="/media/{{article.media}}" alt="">
							{% endif %}
						{% endif %}
						{% autoescape off %}
							{{article.text}}
						{% endautoescape %}
					
					<br><br>
					{% for tag in article.tags.all %}
						<a class="label label-info" href="/search/?q={{tag}}"><i class="icon-tags"></i>{{tag}}</a>
					{% endfor %}
					<br><br>
					{% if member %}
						<form class="form-comment" id="commentForm-{{article.id}}" action="" method="POST">
							<p>Commentaire :</p>
							<textarea name="commentText" cols="30" rows="10"></textarea> <br><br>
							<input type="hidden" name="memberId" value="{{member.id}}">
							<input type="hidden" name="articleId" value="{{article.id}}">
							<p><input type="submit" class="commentArticleButton" id="commentButton-{{article.id}}" value="commenter"></p>
						</form>
					{% else %}
						<p><a href="/login">Connectez vous pour commenter</a></p>
					{% endif %}
					<br><br>

					<h3>Commentaires :</h3>
					<div id="comments-{{article.id}}"></div>
					{% for comment in article.comments %}
						<a href="/profile/{{comment.memberId.id}}">{{comment.memberId}}</a>
						<p>{{comment.text}}</p>
						{% empty %}
							<p>Il n'y a pas de commentaires pour le moment</p>
					{% endfor %}
				

					{% if article.coord != "" and article.coord != "error" %}
						coord: {{article.coord}}
					{% endif %}

					</div>
				</div>
				<div class="span4">
				</div>
			</div>
		    <div class="close-button">x</div>
		    <div class="clear"></div>
		  </div>
	  {% endfor %}

	  <div class="dashboard clearfix">
	      <div class="col1 clearfix">
	      	{% for article in articlesCol1 %}
		        <div class="{{article.category.url}} {% if forloop.counter0|divisibleby:'3' %}big{% else %}small{% endif %} todos-thumb frame" data-page="article-{{article.id}}">
		          <p>{{article.title}}
		            <span class="todos-thumb-span">{{article.date}}</span>
		          </p>
		        </div>
	        {% endfor %}
	      </div>

	      <div class="col2 clearfix">
	      	{% for article in articlesCol2 %}
		        <div class="{% if forloop.counter|divisibleby:'3' %}big{% else %}small{% endif %} todos-thumb frame {{article.category.url}}" data-page="article-{{article.id}}">
		          <p>{{article.title}}
		            <span class="todos-thumb-span">{{article.date}}</span>
		          </p>
		        </div>
	        {% endfor %}
	      </div>

	      <div class="col3 clearfix">
	      	{% for article in articlesCol3 %}
		        <div class="{% if forloop.counter0|divisibleby:'3' %}big{% else %}small{% endif %} todos-thumb frame {{article.category.url}}" data-page="article-{{article.id}}">
		          <p>{{article.title}}
		            <span class="todos-thumb-span">{{article.date}}</span>
		          </p>
		        </div>
	        {% endfor %}
	      </div>

	  </div>
	</div>

{% endblock content %} 

{% block script %}
<script type="text/javascript">

	$(document).ready(
	  setMosaicBackground()
	);
	/**
	  Generating smooth color for background
	**/
	function get_random_color() {
	    var letters = 'ABCDE'.split('');
	    var color = '#';
	    for (var i=0; i<3; i++ ) {
	        color += letters[Math.floor(Math.random() * letters.length)];
	    }
	    return color;
	}
	/**
		Set background for each div/each category
	*/
	function setMosaicBackground(){
	      {% for cat in categories %}
	      	var categoryBackground = {'economie' : "#3399CC", "sciences" : "#33CCCC", "sport" : "#C24747","sante" : "#996699"};
	        var randomBackgroundColor = get_random_color();
	        var catName = '{{cat.url}}';
	        if (categoryBackground[catName])
	        	$('.{{cat.url}}').css("background-color", categoryBackground[catName]);
	        else
	        	$('.{{cat.url}}').css("background-color", randomBackgroundColor);
	      {% endfor %}
	}

	$('.commentArticleButton').bind('click',function(e) {
		e.preventDefault();
		id = this.id;
		id = id.split("-")[1];
		formId = "commentForm-" + id;

		console.log($("#formId"));


		$.ajax({
           type: "POST",
           url: '/comment', 
           data: $("#" + formId).serialize(), // serializes the form's elements.
           success: function(data)
           {
               $("#" + formId).stop().fadeOut(500);
               $("#comments-"+id).prepend(data);
           },
           error: function() {

           }
         });

	});

	
</script>
{% endblock script %}